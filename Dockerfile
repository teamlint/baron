# To run properly, the directory containing the proto files baron will read to
# generate a service must be mounted into the container, so that the output
# generated by baron escapes the container.

# Using scratch as a base image would result in a slightly smaller image,
# which would be fine if baron were a self-contained executable, but protoc
# has difficulty running on a scratch image. Using Alpine Linux alleviates
# these issues and only increases image size by about 5 MB.
FROM golang:alpine3.12
LABEL maintainer="zaquestion@gmail.com"

RUN apk update && apk upgrade && apk add --no-cache protobuf git

RUN go version && go get -u -v github.com/gogo/protobuf/protoc-gen-gogofaster

COPY ./ $GOPATH/src/github.com/teamlint/baron

RUN go install -v github.com/teamlint/baron/...

WORKDIR  /go/src/protos

ENTRYPOINT ["baron"]
